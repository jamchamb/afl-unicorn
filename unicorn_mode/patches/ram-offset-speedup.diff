--- unicorn-1.0.1/qemu/exec.c	2017-04-20 02:14:24.000000000 -0400
+++ unicorn-1.0.1-mod/qemu/exec.c	2018-10-23 19:40:15.167703201 -0400
@@ -994,11 +994,15 @@
 static ram_addr_t ram_block_add(struct uc_struct *uc, RAMBlock *new_block, Error **errp)
 {
     RAMBlock *block;
-    ram_addr_t old_ram_size, new_ram_size;
+    ram_addr_t old_ram_size, new_ram_size, last_offset;
 
-    old_ram_size = last_ram_offset(uc) >> TARGET_PAGE_BITS;
+    last_offset = last_ram_offset(uc);
+    old_ram_size = last_offset >> TARGET_PAGE_BITS;
 
-    new_block->offset = find_ram_offset(uc, new_block->length);
+    // find_ram_offset is really slow with large # of segments
+    // and not really needed in our use case (memory wont change after startup)
+    //new_block->offset = find_ram_offset(uc, new_block->length);
+    new_block->offset = last_offset;
 
     if (!new_block->host) {
         new_block->host = phys_mem_alloc(new_block->length,
